import{_ as s,c as n,o as a,b as l}from"./app.40687699.js";const i=JSON.parse('{"title":"ASP.NET Core integration","description":"","frontmatter":{},"headers":[{"level":2,"title":"TestBase class Example","slug":"testbase-class-example","link":"#testbase-class-example","children":[]}],"relativePath":"rest/asp-net.md","lastUpdated":1673154033000}'),p={name:"rest/asp-net.md"},o=l(`<h1 id="asp-net-core-integration" tabindex="-1"><a href="http://ASP.NET" target="_blank" rel="noreferrer">ASP.NET</a> Core integration <a class="header-anchor" href="#asp-net-core-integration" aria-hidden="true">#</a></h1><p>You will most likely want to test your <a href="http://ASP.NET" target="_blank" rel="noreferrer">ASP.NET</a> Core application. The <a href="https://www.nuget.org/packages/FlueFlame.AspNetCore/" target="_blank" rel="noreferrer">FlueFlame.AspNetCore</a> package will help you with this.</p><p>FlueFlame will use <code>TestServer</code> from the <code>Microsoft.AspNetCore.Mvc.Testing</code> package.</p><p>FlueFlame create <code>TestServer</code> from <code>WebApplicationFactory</code>:</p><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webApp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebApplicationFactory</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Program</span><span style="color:#89DDFF;">&gt;()</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WithWebHostBuilder</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">builder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ConfigureServices</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">services</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//Configure your services here</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Since C# 9.0, the <code>Program</code> class does not exists if you use <a href="https://learn.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#top-level-statements" target="_blank" rel="noreferrer">Top-level statements</a>. It can be declared by adding the following code in the end of <code>Program.cs</code> file:</p><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">namespace</span><span style="color:#A6ACCD;"> Testing</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TestData</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">AspNetCore</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">partial</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Program</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Also you can do that by either using the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.internalsvisibletoattribute?view=net-6.0" target="_blank" rel="noreferrer">InternalsVisibleToAttribute</a> in your main application project, or use this within the project file of your application where &quot;ProjectName.Tests.EndToEnd&quot; would be your testing project name:</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">ItemGroup</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">InternalsVisibleTo</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">Include</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ProjectName.Tests.EndToEnd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">ItemGroup</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>And then use <code>global::</code> prefix:</p><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">WebApplicationFactory</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">global</span><span style="color:#89DDFF;">::</span><span style="color:#FFCB6B;">Program</span><span style="color:#89DDFF;">&gt;()</span></span>
<span class="line"></span></code></pre></div></div><p>You will most likely need to set up your application for testing purposes. For example, replace your database with InMemory:</p><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webApp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebApplicationFactory</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Program</span><span style="color:#89DDFF;">&gt;()</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WithWebHostBuilder</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">builder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ConfigureServices</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">services</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//Configure your services here</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dbContextDescriptor</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SingleOrDefault</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#FFCB6B;">d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> d</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ServiceType </span><span style="color:#89DDFF;">==</span></span>
<span class="line"><span style="color:#A6ACCD;">				     </span><span style="color:#F78C6C;">typeof</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">DbContextOptions</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">EmployeeContext</span><span style="color:#89DDFF;">&gt;));</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span></span>
<span class="line"><span style="color:#A6ACCD;">			services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dbContextDescriptor</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//Unique Database name for each test.</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dbName</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Employee_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Guid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">NewGuid</span><span style="color:#89DDFF;">()}&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//Use InMemory Database</span></span>
<span class="line"><span style="color:#A6ACCD;">			services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddDbContext</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">EmployeeContext</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#FFCB6B;">x</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">UseInMemoryDatabase</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dbName</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span></code></pre></div><p>Create <code>IFlueFlameHttpHost</code>:</p><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki"><code><span class="line"><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">httpHost</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> FlueFlameAspNetBuilder</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CreateDefaultBuilder</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">webApp</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">BuildHttpHost</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><h2 id="testbase-class-example" tabindex="-1">TestBase class Example <a class="header-anchor" href="#testbase-class-example" aria-hidden="true">#</a></h2><p>The following is an example of the <code>TestBase</code> class for testing <a href="http://ASP.NET" target="_blank" rel="noreferrer">ASP.NET</a> Core:</p><div class="language-csharp"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">abstract</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestBase</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IDisposable</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IFlueFlameHttpHost</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HttpHost</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IServiceProvider</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ServiceProvider</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestServer</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestServer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TestBase</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">webApp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebApplicationFactory</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Program</span><span style="color:#89DDFF;">&gt;()</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">WithWebHostBuilder</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">builder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ConfigureServices</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">services</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">					</span><span style="color:#676E95;">//Configure your services here</span></span>
<span class="line"><span style="color:#A6ACCD;">					</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dbContextDescriptor</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SingleOrDefault</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">						</span><span style="color:#FFCB6B;">d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> d</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ServiceType </span><span style="color:#89DDFF;">==</span></span>
<span class="line"><span style="color:#A6ACCD;">						     </span><span style="color:#F78C6C;">typeof</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">DbContextOptions</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">EmployeeContext</span><span style="color:#89DDFF;">&gt;));</span></span>
<span class="line"><span style="color:#A6ACCD;">					</span></span>
<span class="line"><span style="color:#A6ACCD;">					services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dbContextDescriptor</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">					</span><span style="color:#676E95;">//Unique Database name for each test.</span></span>
<span class="line"><span style="color:#A6ACCD;">					</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dbName</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Employee_</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">Guid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">NewGuid</span><span style="color:#89DDFF;">()}&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">					</span></span>
<span class="line"><span style="color:#89DDFF;">					</span><span style="color:#676E95;">//Use InMemory Database</span></span>
<span class="line"><span style="color:#A6ACCD;">					services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddDbContext</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">EmployeeContext</span><span style="color:#89DDFF;">&gt;(</span><span style="color:#FFCB6B;">x</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span><span style="color:#A6ACCD;"> x</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">UseInMemoryDatabase</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dbName</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">		TestServer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> webApp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Server</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">		ServiceProvider </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> webApp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Services</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">builder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> FlueFlameAspNetBuilder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CreateDefaultBuilder</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">webApp</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ConfigureHttpClient</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">c</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">				</span><span style="color:#676E95;">//Configure HttpClient for all FlueFlame hosts such as HttpHost, GrpcHost, SignalRHost...</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span></span>
<span class="line"><span style="color:#89DDFF;">				</span><span style="color:#676E95;">//Add JWT token to default request headers</span></span>
<span class="line"><span style="color:#A6ACCD;">				c</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DefaultRequestHeaders</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Add</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Authorization</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$&quot;</span><span style="color:#C3E88D;">Bearer </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">GetJwtToken</span><span style="color:#89DDFF;">()}&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">		HttpHost </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">BuildHttpHost</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">b</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//Use System.Text.Json serializer</span></span>
<span class="line"><span style="color:#A6ACCD;">			b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">UseTextJsonSerializer</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">//Configure HttpClient only for FlueFlameHttpHost</span></span>
<span class="line"><span style="color:#A6ACCD;">			b</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ConfigureHttpClient</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">client</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">				</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">GetJwtToken</span><span style="color:#89DDFF;">(string</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">role</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TimeSpan</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">lifetime</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">jwt</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">JwtSecurityToken</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">issuer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> AuthOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ISSUER</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">audience</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> AuthOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">AUDIENCE</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">notBefore</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> DateTime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UtcNow</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">claims</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Claim</span><span style="color:#89DDFF;">&gt;()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">new</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ClaimsIdentity</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">DefaultRoleClaimType</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> role</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">expires</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> DateTime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UtcNow</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">Add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">lifetime </span><span style="color:#89DDFF;">??</span><span style="color:#A6ACCD;"> TimeSpan</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">FromMinutes</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AuthOptions</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">LIFETIME</span><span style="color:#89DDFF;">)),</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#FFCB6B;">signingCredentials</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SigningCredentials</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AuthOptions</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetSymmetricSecurityKey</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#A6ACCD;">				SecurityAlgorithms</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">HmacSha256</span><span style="color:#89DDFF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">JwtSecurityTokenHandler</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">WriteToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">jwt</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Dispose</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">using</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">scope</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ServiceProvider</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CreateScope</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">var</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ctx</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> scope</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ServiceProvider</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">GetRequiredService</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">EmployeeContext</span><span style="color:#89DDFF;">&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">		ctx</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Database</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">EnsureDeleted</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">		GC</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">SuppressFinalize</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">this</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span></span>
<span class="line"></span></code></pre></div>`,13),e=[o];function t(c,r,D,F,y,C){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{i as __pageData,d as default};
